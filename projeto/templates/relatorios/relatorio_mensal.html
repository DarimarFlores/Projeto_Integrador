{% extends "base.html" %}
{% block title %}Relatório Mensal{% endblock %}

{% block content %}
<h1>Relatório mensal – {{ mes_nome }}</h1>

<!-- Filtro de mês -->
<div class="card">
  <form method="get" class="filtro-mes-form">
    <label for="mes">Escolha o mês</label>
    <select name="mes" id="mes" onchange="this.form.submit()">
      {% for codigo, nome in meses %}
        <option value="{{ codigo }}" {% if codigo == mes_filtro %}selected{% endif %}>
          {{ nome }}
        </option>
      {% endfor %}
    </select>
  </form>
</div>

<!-- Tabela de Rendas -->
<div class="card">
  <h2>Rendas do mês</h2>
  <div class="table-responsive">
    <table class="tabela-despesas">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Data</th>
          <th>Valor</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rendas %}
          <tr>
            <td>{{ r.get_tipo_display|default:r.tipo }}</td>
            <td>{{ r.data_recebimento|date:"d/m/Y" }}</td>
            <td>R$ {{ r.valor|floatformat:2 }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="3">Nenhuma renda cadastrada neste mês.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card resumo-mensal-card">  
  
    <div class="resumo-mensal-lista">
      <span class="resumo-label"> Total Rendas:   </span>
      <span class="resumo-valor renda">R$ {{ total_renda_mes|floatformat:2 }}</span>
    </div>
</div>

<!-- Tabela de Despesas -->
<div class="card">
  <h2>Despesas do mês</h2>
  <div class="table-responsive">
    <table class="tabela-despesas">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Tipo</th>
          <th>Vencimento</th>
          <th>Valor</th>
          <th>Pago?</th>
        </tr>
      </thead>
      <tbody>
        {% for d in despesas %}
          <tr>
            <td>{{ d.nome }}</td>
            <td>{{ d.get_tipo_despesa_display|default:d.tipo }}</td>
            <td>{{ d.data_vencimento|date:"d/m/Y" }}</td>
            <td>R$ {{ d.valor|floatformat:2 }}</td>
            <td>
              {% if d.pago %}
                <span class="badge bg-success"><i class="bi bi-check-circle"></i></span>
              {% else %}
                <span class="badge bg-danger"><i class="bi bi-hourglass-split"></i></span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5">Nenhuma despesa cadastrada neste mês.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card resumo-mensal-card">
  <div class="resumo-mensal-lista">
    <span class="resumo-label">Total Despesas:   </span>
    <span class="resumo-valor despesas">R$ {{ total_despesas_mes|floatformat:2 }}</span>
  </div>
</div>

<!-- Tabela de Financiamentos -->
<div class="card">
  <h2>Financiamentos do mês</h2>
  <div class="table-responsive">
    <table class="tabela-despesas">
      <thead>
        <tr>
          <th>Credor</th>
          <th>Tipo</th>
          <th>Início</th>
          <th>Vencimento</th>
          <th>Parcela</th>
          <th>Pago?</th>
        </tr>
      </thead>
      <tbody>
        {% for f in financiamentos %}
          <tr>
            <td>{{ f.credor }}</td>
            <td>{{ f.get_tipo_display }}</td>
            <td>{{ f.data_inicio|date:"d/m/Y" }}</td>
            <td>{{ f.data_fim|date:"d/m/Y" }}</td>
            <td>R$ {{ f.valor_parcela|floatformat:2 }}</td>
            <td>
              {% if f.pago %}
                <span class="badge bg-success"><i class="bi bi-check-circle"></i></span>
              {% else %}
                <span class="badge bg-danger"><i class="bi bi-hourglass-split"></i></span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6">Nenhum financiamento cadastrado neste mês.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card resumo-mensal-card">
  <div class="resumo-mensal-lista">
    <span class="resumo-label">Total Financiamentos:</span>
    <span class="resumo-valor financiamentos">R$ {{ total_financiamentos_mes|floatformat:2 }}</span>
  </div>
</div>
 
<div class="resumo-saldo">
  <h2>Saldo total do mês: R$ {{ saldo_mes|floatformat:2 }}</h2>   
</div>

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
    <button type="button" class="btn" onclick="window.print()">Imprimir / salvar em PDF</button>
</div>
   
{% endblock %}





