{% extends "base.html" %}
{% block title %}Meta de Poupança{% endblock %}

{% block content %}
<h1>Meta de Poupança</h1>

<div class="meta-grid">

  <!-- Situação atual do mês -->
  <div class="card meta-card">
    <h2>Situação do mês de {{ mes_atual_nome }}</h2>
    <ul class="meta-situacao-lista">
      <li>Renda do mês: R$ {{ total_renda_mes|floatformat:2 }}</li>
      <li>Despesas do mês: R$ {{ total_despesas_mes|floatformat:2 }}</li>
      <li>Financiamentos do mês: R$ {{ total_financiamentos_mes|floatformat:2 }}</li>
      <li>
        Saldo do mês:
        <strong style="color:#00b894;">
          R$ {{ saldo_mes|floatformat:2 }}
        </strong>
      </li>
    </ul>
  </div>

  <!-- Formulário da meta -->
  <div class="card meta-card">
    <h2>Simular uma meta de poupança</h2>
    <form method="get">
      <div class="meta-form-row">
        <div class="meta-input-group">
          <label for="valor_meta">Valor da meta (R$)</label>
          <input type="text" id="valor_meta" name="valor_meta"
                 value="{{ valor_meta|default_if_none:'' }}">
        </div>
        <div class="meta-input-group">
          <label for="prazo_meses">Prazo (em meses)</label>
          <input type="number" id="prazo_meses" name="prazo_meses"
                 min="1" value="{{ prazo_meses|default_if_none:'' }}">
        </div>
      </div>
      <button type="submit" class="btn" style="margin-top:12px;">Calcular</button>
    </form>
  </div>
  
  <!-- Resultado -->
  <div class="card meta-card">
    <h2>Resultado da simulação</h2>

    {# 1) ainda não simulou nada #}
    {% if not houve_simulacao %}
      <p class="card-resumo-label">
        Preencha os campos acima e clique em <strong>Calcular</strong> para ver a simulação.
      </p>

    {# 2) simulou e NÃO deu erro (temos valores válidos) #}
    {% elif not mostrar_erro %}
      <p>
        Para juntar <strong>R$ {{ valor_meta|floatformat:2 }}</strong> em
        <strong>{{ prazo_meses }}</strong> mês(es),
        você precisa guardar aproximadamente
        <strong>R$ {{ poupanca_mensal|floatformat:2 }}</strong> por mês.
      </p>

      {% if saldo_mes > 0 and saldo_mes >= poupanca_mensal %}
        <hr>
        <p>
          Com o seu saldo atual de <strong>R$ {{ saldo_mes|floatformat:2 }}</strong> por mês,
          você levaria cerca de
          <strong>{{ prazo_ideal|floatformat:1 }}</strong> mês(es)
          para atingir essa meta, se guardar todo o saldo positivo.
        </p>
      {% else %}
        <p>
          No momento, o saldo do mês é zero ou negativo, então não é possível atingir essa meta
          apenas com o que sobra do seu orçamento. Talvez valha ajustar despesas,
          financiamentos ou aumentar a renda.
        </p>
      {% endif %}

    {# 3) simulou mas tem problema nos valores #}
    {% else %}
      <p class="card-resumo-label" style="color:#ff7675;">
        Não foi possível calcular a poupança mensal.
        Confira se você informou um <strong>valor de meta</strong> e um
        <strong>prazo em meses</strong> maiores que zero.
      </p>
    {% endif %}
  </div>

</div>
{% endblock %}