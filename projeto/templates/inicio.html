{% extends "base.html" %}
{% block title %}InÃ­cio{% endblock %}

{% block content %}
<h1 class="card-resumo">Resumo {{ mes_atual_nome }}</h1>

<!-- cards principais -->
<div class="dashboard-grid">

  <div class="card card-resumo card-resumo-renda">
    <h2>Renda</h2>
    <p class="card-resumo-valor">R$ {{ total_renda|floatformat:2 }}</p>
    <p class="card-resumo-label">Entradas de dinheiro</p>
    <a href="{% url 'rendamensal:cadastro_renda' %}" class="btn btn-sm">Ver detalhes</a>
  </div>

  <div class="card card-resumo card-resumo-despesas">
    <h2>Despesas</h2>
    <p class="card-resumo-valor">R$ {{ total_despesas|floatformat:2 }}</p>
    <p class="card-resumo-label">Gastos gerais</p>
    <a href="{% url 'despesas:lista_despesas' %}" class="btn btn-sm">Ver detalhes</a>
  </div>

  <div class="card card-resumo card-resumo-financiamentos">
    <h2>Financiamentos</h2>
    <p class="card-resumo-valor">R$ {{ total_financiamentos|floatformat:2 }}</p>
    <p class="card-resumo-label">Parcelas e dÃ­vidas</p>
    <a href="{% url 'financiamentos:lista_financiamentos' %}" class="btn btn-sm">Ver detalhes</a>
  </div>

</div>

<!-- saldo geral -->
<div class="card">
  <h2>Saldo do mÃªs</h2>
  <p>
    {% if saldo >= 0 %}
      <span style="color:#00b894; font-size:1.4rem; font-weight:bold;">
        R$ {{ saldo|floatformat:2 }}
      </span>
      <span> â€¢ SituaÃ§Ã£o positiva ðŸ™‚</span>
    {% else %}
      <span style="color:#ff7675; font-size:1.4rem; font-weight:bold;">
        R$ {{ saldo|floatformat:2 }}
      </span>
      <span> â€¢ AtenÃ§Ã£o: gastos maiores que a renda ðŸ˜¬</span>
    {% endif %}
  </p>
</div>

<!-- grÃ¡fico de saÃºde financeira -->
<div class="card">
  <h2>SaÃºde financeira ao longo dos meses</h2>
  <p class="card-resumo-label">
    Compare a evoluÃ§Ã£o de renda, despesas, financiamentos e saldo ao longo do ano.
  </p>
  <canvas id="graficoSaude" height="120"></canvas>
</div>

<!-- script do grÃ¡fico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ labels_json|default:"[]"|safe }};
  const dadosRenda = {{ renda_por_mes_json|default:"[]"|safe }};
  const dadosDespesas = {{ despesas_por_mes_json|default:"[]"|safe }};
  const dadosFinanciamentos = {{ financiamentos_por_mes_json|default:"[]"|safe }};
  const dadosSaldo = {{ saldo_por_mes_json|default:"[]"|safe }};

  const ctx = document.getElementById('graficoSaude').getContext('2d');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Renda',
          data: dadosRenda,
          borderColor: '#00b894',
          backgroundColor: 'rgba(0,184,148,0.2)',
          tension: 0.3
        },
        {
          label: 'Despesas',
          data: dadosDespesas,
          borderColor: '#ff7675',
          backgroundColor: 'rgba(255,118,117,0.2)',
          tension: 0.3
        },
        {
          label: 'Financiamentos',
          data: dadosFinanciamentos,
          borderColor: '#0984e3',
          backgroundColor: 'rgba(9,132,227,0.2)',
          tension: 0.3
        },
        {
          label: 'Saldo',
          data: dadosSaldo,
          borderColor: '#fdcb6e',
          backgroundColor: 'rgba(253,203,110,0.2)',
          borderDash: [5, 5],
          tension: 0.3
        },
      ]
    },
    options: {
      plugins: {
        legend: {
          labels: {
            color: '#ffffff'
          }
        }
      },
      scales: {
        x: {
          ticks: { color: '#ffffff' },
          grid: { color: 'rgba(255,255,255,0.05)' }
        },
        y: {
          ticks: { color: '#ffffff' },
          grid: { color: 'rgba(255,255,255,0.05)' }
        }
      }
    }
  });
</script>
{% endblock %}