{% extends 'base.html' %}
{% block title %}Financiamentos{% endblock %}
{% load l10n %}

{% block content %}
<div class="container mt-4">

  <!-- Cabeçalho + botão -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Financiamentos</h1>
    <p>Gerencie aqui seus financiamentos e parcelas mensais.</p>
    <a href="{% url 'financiamentos:novo_financiamento' %}" class="btn btn-primary btn-sm">
      + Novo Financiamento
    </a>
  </div>

  <!-- Filtro por mês -->
  <div class="card filtro-mes-card mb-3">
    <div class="card-body">
      <form method="get" class="row g-2 align-items-end">
        
        <div class="col-sm-4">
          <label for="mes" class="form-label">Filtrar por mês</label>
          <select name="mes" id="mes" class="form-select form-select-sm" onchange="this.form.submit()">
            <option value="">-- Todos os meses --</option>
            {% for codigo, nome_mes in meses %}
              <option value="{{ codigo }}" {% if codigo == mes %}selected{% endif %}>
                {{ nome_mes }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-sm-4">
          <label for="status" class="form-label">Status</label>
          <select name="status" id="status" class="form-select form-select-sm" onchange="this.form.submit()">
            <option value="" {% if not status %}selected{% endif %}>Todos</option>
            <option value="pago" {% if status == 'pago' %}selected{% endif %}>Pagos</option>
            <option value="pendente" {% if status == 'pendente' %}selected{% endif %}>Pendentes</option>
          </select>
        </div>

      </form>
    </div>
  </div>

  <!-- Total do mês -->
  {% if total_mes is not None %}
  <div class="card mb-3">
    <div class="card-body">
      <h2 class="h6 mb-0">
        Total das parcelas do mês:
        <span class="fw-bold text-success">R$ {{ total_mes|floatformat:2|localize }}</span>
      </h2>
    </div>
  </div>
  {% endif %}

  <!-- Tabela de financiamentos -->
  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="tabela-despesas">
  <thead>
    <tr>
      <th>Mês</th>
      <th>Credor</th>
      <th>Tipo</th>
      <th>Valor da Parcela</th>
      <th>Data de Vencimento</th>
      <th>Pago</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for f in financiamentos %}
    <tr>
      <td>{{ f.get_mes_display }}</td>
      <td>{{ f.credor }}</td>
      <td>{{ f.get_tipo_display }}</td>
      <td>R$ {{ f.valor_parcela|floatformat:2|localize }}</td>
      <td>{{ f.data_vencimento|date:"d/m/Y" }}</td>

      <td>
        {% if f.pago %}
          <span class="badge bg-success"><i class="bi bi-check-circle"></i></span>
        {% else %}
          <span class="badge bg-danger"><i class="bi bi-hourglass-split"></i></span>
        {% endif %}
      </td>

      <td>
        {% if mostrar_botoes %}
          <div class="tabela-acoes">
            <a href="{% url 'financiamentos:editar_financiamento' f.id %}"
               class="btn-acao" title="Editar">
              <i class="fa-solid fa-pen-to-square"></i>
            </a>

            <a href="{% url 'financiamentos:remover_financiamento' f.id %}"
               class="btn-acao btn-acao-remover" title="Remover"
               onclick="return confirm('Tem certeza que deseja remover este financiamento?');">
              <i class="bi bi-trash"></i>
            </a>
          </div>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7" class="text-center">Nenhum financiamento cadastrado.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
      </div>
    </div>
  </div>

</div>
{% endblock %}