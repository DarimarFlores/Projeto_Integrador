{% extends "base.html" %}
{% block title %}Renda Mensal{% endblock %}
{% block content %}

<div class="container mt-4">

  <!-- Título + botão Nova Renda -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Renda Mensal</h1>
    <p>Bem-vindo à seção de rendas mensais. Aqui você poderá cadastrar, editar e acompanhar suas rendas.</p>
    <a href="{% url 'rendamensal:nova_renda' %}" class="btn btn-primary btn-sm">
    Nova Renda
    </a>
  </div>

  <!-- Filtro por mês -->
  <div class="card filtro-mes-card">
  <form method="GET" class="filtro-mes-form">
    <label for="mes">Selecione o mês:</label>
    <select name="mes" id="mes" onchange="this.form.submit()">
      <option value="" {% if not mes_atual %}selected{% endif %}>-- Todos os meses --</option>
      {% for codigo, nome_mes in meses %}
        <option value="{{ codigo }}" {% if mes_atual == codigo %}selected{% endif %}>
          {{ nome_mes }}
        </option>
      {% endfor %}
    </select>
  </form>
</div>

<!-- Total do mês atual -->
{% if mostrar_total_mes %}
  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-0">
        Total do mês:
        {% for codigo, nome_mes in meses %}
          {% if codigo == mes_atual %}
            {{ nome_mes }}
          {% endif %}
        {% endfor %}
        – <span class="fw-bold text-success">
          R$ {{ total_mes_atual|floatformat:2 }}
        </span>
      </h3>
    </div>
  </div>
{% endif %}

  <!-- Lista de rendas do mês atual -->
  {% if mes_atual %}
  <!-- Quando um mês foi selecionado -->
  <h2 class="h5 mt-4">
    Rendas de
    {% for codigo, nome_mes in meses %}
      {% if codigo == mes_atual %}
        {{ nome_mes }}
      {% endif %}
    {% endfor %}
  </h2>
{% else %}
  <!-- Quando está em "Todos os meses" -->
  <h2 class="h5 mt-4">
    Histórico de todas as rendas
  </h2>
{% endif %}

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="tabela-despesas">
        <thead>
          <tr>
            <th>Mês</th>
            <th>Tipo</th>
            <th>Valor</th>
            <th>Data de recebimento</th>
            {% if mostrar_botoes %}
              <th style="width: 140px;">Ações</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for renda in rendas %}
            <tr>
              <td>{{ renda.get_mes_display }}</td>
              <td>{{ renda.get_tipo_display }}</td>
              <td>R$ {{ renda.valor|floatformat:2 }}</td>
              <td>{{ renda.data_recebimento|date:"d/m/Y" }}</td>

              {% if mostrar_botoes %}
                <td>
                  <div class="tabela-acoes">
                    <a href="{% url 'rendamensal:editar_renda' renda.id %}?mes={{ mes_atual }}" class="btn-acao" title="Editar"><i class="fa-solid fa-pen-to-square"></i></a>
                    <a href="{% url 'rendamensal:remover_renda' renda.id %}?mes={{ mes_atual }}" class="btn-acao btn-acao-remover" title="Remover" onclick="return confirm('Tem certeza que deseja excluir?')"><i class="bi bi-trash"></i></a>
                  </div>
                </td>
              {% endif %}
            </tr>
          {% empty %}
            <tr>
              <td colspan="{% if mostrar_botoes %}5{% else %}4{% endif %}" class="text-center">
                Nenhuma renda cadastrada.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}